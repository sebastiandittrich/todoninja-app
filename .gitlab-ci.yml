stages:
  - build
  - deploy

image: node:8.12

build:
  stage: build
  script:
    - npm install
    - npm run build
  artifacts:
    paths:
      - dist


deploy:
  stage: deploy
  only:
    - master
  variables:
    GIT_STRATEGY: none
  script:
    - mkdir ~/.ssh
    - echo "$SSH_PRIVATE_KEY" > ~/.ssh/id_rsa
    - echo "$SSH_PUBLIC_KEY" >> ~/.ssh/id_rsa.pub
    - chmod 600 ~/.ssh/id_rsa
    - chmod 600 ~/.ssh/id_rsa.pub
    - scp -r dist $SSH_USER@$SSH_HOST:~/app